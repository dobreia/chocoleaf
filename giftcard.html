<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Courgette">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Exo+2">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre Baskerville">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">

    <link rel="stylesheet" href="giftcard.css">
    <link rel="stylesheet" href="style.css">
    <title>Gal√©ria | Chocoleaf</title>
</head>

<body class="bg-cream">
    <nav class="navbar navbar-expand-xl custom-navbar">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
                <ul class="navbar-nav mx-auto text-center">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">F≈ëoldal</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#introduction">R√≥lam</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="gallery.html">Munk√°im</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#footer">Kapcsolat</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Aj√°nd√©kutalv√°ny</a>
                    </li>
                </ul>
            </div>
            <div class="nav-buttons">
                <a href="index.html#form"><button class="button-primary">Aj√°nlatk√©r√©s</button></a>
                <a href="./idopont.html"><button class="button-secondary">K√©pz√©sek</button></a>
            </div>
        </div>
    </nav>

    <section class="giftcard-section">
        <div class="container-lg">
            <h1 class="main">Aj√°nd√©kutalv√°ny √âdess√©gk√©sz√≠t≈ë workshopra</h1>
            <p class="second">Lepj meg valakit egy √âdes √âlm√©nnyel!<br>
                Az aj√°nd√©kutalv√°ny 1 f≈ë r√©sz√©re sz√≥l √©s bev√°lthat√≥ a ChocoLeaf b√°rmelyik √©dess√©gk√©sz√≠t≈ë workshopj√°ra az
                utalv√°ny √©rt√©k√©ben.</p>
            <section class="amount">
                <h3>√ârt√©k:</h3>
                <div class="amount-buttons">
                    <button class="amount-btn" onclick="selectAmount(10000)">10 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(14900)">14 900 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(20000)">20 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(25000)">25 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(30000)">30 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(35000)">35 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(37900)">37 900 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(40000)">40 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(45000)">45 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(50000)">50 000 Ft</button>
                </div>
            </section>
            <section class="quantity mt-4">
                <h3>Mennyis√©g:</h3>
                <div class="quantity-input">
                    <button onclick="changeQty(-1)">-</button>
                    <input type="number" id="qty" value="1" min="1">
                    <button onclick="changeQty(1)">+</button>
                </div>
            </section>
            <button id="PayBtn" class="button-primary mt-4" onclick="startPayment()">Tov√°bb a fizet√©shez</button>
        </div>
    </section>

    <script>
        let selectedAmount = null;

        function selectAmount(value) {
            selectedAmount = value;
            document.querySelectorAll(".amount-btn").forEach(btn => btn.classList.remove("active"));
            event.target.classList.add("active");
        }

        function changeQty(delta) {
            const input = document.getElementById("qty");
            let newValue = parseInt(input.value) + delta;
            if (newValue < 1) newValue = 1;
            input.value = newValue;
        }

        async function startPayment() {
            if (!selectedAmount) {
                alert("K√©rlek v√°lassz √∂sszeget!");
                return;
            }

            const qty = parseInt(document.getElementById("qty").value) || 1;
            const total = selectedAmount * qty;

            const url = "https://api.test.barion.com/v2/Payment/Start";

            // üîë Saj√°t Barion sandbox adataid
            const POSKey = "d85be135-f5bc-4c84-a8fe-fc3bc55012bb";
            const MerchantId = "dobreiandras@gmail.com";

            const paymentRequest = {
                POSKey: POSKey,
                PaymentType: "Immediate",
                GuestCheckOut: true,
                FundingSources: ["All"],
                PaymentRequestId: "giftcard-" + total + "-" + Date.now(),
                OrderNumber: "GC-" + Date.now(),
                Currency: "HUF",
                RedirectUrl: "http://127.0.0.1:5500/redirect.html",   // siker ut√°n ide ir√°ny√≠t
                Transactions: [
                    {
                        POSTransactionId: "T" + Date.now(),
                        Payee: MerchantId,
                        Total: total,
                        Comment: `ChocoLeaf Aj√°nd√©kutalv√°ny ${qty} √ó ${selectedAmount} Ft`,
                        Items: [
                            {
                                Name: "ChocoLeaf Aj√°nd√©kutalv√°ny",
                                Description: `${qty} √ó ${selectedAmount} Ft √©rt√©k≈± aj√°nd√©kutalv√°ny`,
                                Quantity: qty,
                                Unit: "db",
                                UnitPrice: selectedAmount,
                                ItemTotal: total
                            }
                        ]
                    }
                ]
            };

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(paymentRequest)
                });

                const data = await response.json();
                console.log("Barion response:", data);

                if (data.GatewayUrl) {
                    window.location.href = data.GatewayUrl; // √°tir√°ny√≠t√°s a fizet≈ëoldalra
                } else {
                    alert("Hiba t√∂rt√©nt: " + (data.Errors?.[0]?.Title || "Ismeretlen hiba"));
                }
            } catch (err) {
                console.error("H√°l√≥zati hiba:", err);
                alert("Nem siker√ºlt kapcsol√≥dni a Barion API-hoz.");
            }
        }
    </script>



    <!-- Bootstrap + JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
        crossorigin="anonymous"></script>

</body>

</html>