<script>
    async function startCoursePayment(courseId, courseName, price) {
        const POSKey = "d85be135-f5bc-4c84-a8fe-fc3bc55012bb";
        const MerchantId = "dobreiandras@gmail.com";

        const paymentRequest = {
            POSKey,
            PaymentType: "Immediate",
            GuestCheckOut: true,
            FundingSources: ["All"],
            PaymentRequestId: "course-" + courseId + "-" + Date.now(),
            OrderNumber: "COURSE-" + Date.now(),
            Currency: "HUF",
            RedirectUrl: "https://dobreia.github.io/chocoleaf/redirect.html?course=" + courseId,
            Transactions: [{
                POSTransactionId: "T" + Date.now(),
                Payee: MerchantId,
                Total: price,
                Comment: courseName,
                Items: [{
                    Name: courseName,
                    Description: "1 fő részvétel",
                    Quantity: 1,
                    Unit: "db",
                    UnitPrice: price,
                    ItemTotal: price
                }]
            }]
        };

        try {
            const response = await fetch("https://api.test.barion.com/v2/Payment/Start", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(paymentRequest)
            });
            const data = await response.json();
            if (data.GatewayUrl) {
                window.location.href = data.GatewayUrl;
            } else {
                alert("Hiba: " + (data.Errors?.[0]?.Title || "Ismeretlen hiba"));
            }
        } catch (err) {
            alert("Nem sikerült kapcsolódni a Barionhoz.");
            console.error(err);
        }
    }
</script>