<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/giftcard_redirect.css">
    <title>Ajándékkártya sikeres vásárlás</title>
</head>

<body>
    <h1>Köszönjük a vásárlást!</h1>
    <p id="message"></p>

    <a href="/"><button class="button-primary">Vissza a főoldalra</button></a>



    <script>

        const params = new URLSearchParams(window.location.search);
        const paymentId = params.get("paymentId");

        if (paymentId) {
            fetch(`/api/giftcard/status?paymentId=${paymentId}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById("message").innerText =
                            `Az ajándékkártyát elküldtük a(z) ${data.userData.email} címre. Ha pár percen belül nem találod a levelet, nézd meg a spam mappát is —
és ha ott sincs, írj bátran, segítek!`;
                        // voucher készítés backend hívással
                        fetch("/api/giftcard/generate", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                name: data.userData.name,
                                email: data.userData.email,
                                amount: data.userData.amount,
                                quantity: data.userData.quantity,
                                serial: data.userData.serial
                            })
                        });
                    } else {
                        document.getElementById("message").innerText =
                            "A fizetésedet nem sikerült egyértelműen azonosítani. "
                            + "Ha a Barion rendszere szerint sikeres volt a tranzakció, kérlek, jelezd nekem, hogy utánanézhessek.";

                    }
                })
                .catch(err => {
                    console.error("Hiba a lekérdezésnél:", err);
                    document.getElementById("message").innerText =
                        "Hiba történt a fizetés állapotának lekérdezése közben. "
                        + "Kérlek, frissítsd az oldalt egy perc múlva, vagy írj, ha a probléma továbbra is fennáll.";

                });
        } else {
            document.getElementById("message").innerText =
                "Nem találtunk fizetési azonosítót az URL-ben. "
                + "Kérlek, ellenőrizd, hogy a vásárlás befejeződött-e, vagy lépj vissza a főoldalra és próbáld újra.";

        }
    </script>

</body>

</html>