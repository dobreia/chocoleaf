<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Courgette">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Exo+2">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre Baskerville">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">

    <link rel="stylesheet" href="css/giftcard.css">
    <link rel="stylesheet" href="css/style.css">
    <title>Galéria | Chocoleaf</title>
</head>

<body class="bg-cream">
    <nav class="navbar navbar-expand-xl custom-navbar">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
                <ul class="navbar-nav mx-auto text-center">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Főoldal</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#introduction">Rólam</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="gallery.html">Munkáim</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#footer">Kapcsolat</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="giftcard.html">Ajándékutalvány</a>
                    </li>
                </ul>
            </div>
            <div class="nav-buttons">
                <a href="index.html#form"><button class="button-primary">Ajánlatkérés</button></a>
                <a href="./idopont.html"><button class="button-secondary">Képzések</button></a>
            </div>
        </div>
    </nav>

    <section class="giftcard-section">
        <div class="container-lg">
            <h1 class="main">Ajándékutalvány Édességkészítő workshopra</h1>
            <p class="second">Lepj meg valakit egy Édes Élménnyel!<br>
                Az ajándékutalvány 1 fő részére szól és beváltható a ChocoLeaf bármelyik édességkészítő workshopjára az
                utalvány értékében.</p>
            <section class="amount">
                <h3>Érték:</h3>
                <div class="amount-buttons">
                    <button class="amount-btn" onclick="selectAmount(10000)">10 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(14900)">14 900 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(20000)">20 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(25000)">25 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(30000)">30 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(35000)">35 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(37900)">37 900 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(40000)">40 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(45000)">45 000 Ft</button>
                    <button class="amount-btn" onclick="selectAmount(50000)">50 000 Ft</button>
                </div>
            </section>
            <section class="quantity mt-4">
                <h3>Mennyiség:</h3>
                <div class="quantity-input">
                    <button onclick="changeQty(-1)">-</button>
                    <input type="number" id="qty" value="1" min="1">
                    <button onclick="changeQty(1)">+</button>
                </div>
            </section>
            <form id="giftForm">
                <label for="name" class="form-label mt-4">Név:</label>
                <input type="text" id="name" name="name">
                <label for="email" class="form-label mt-4">E-mail cím (ahová az utalványt küldjük):</label>
                <input type="email" id="email" class="form-control" placeholder="E-mail cím">
            </form>
            <button id="PayBtn" class="button-primary mt-4" onclick="startPayment()">Tovább a fizetéshez</button>

        </div>
    </section>

    <script>
        let selectedAmount = null;

        function selectAmount(value) {
            selectedAmount = value;
            document.querySelectorAll(".amount-btn").forEach(btn => btn.classList.remove("active"));
            event.target.classList.add("active");
        }

        function changeQty(delta) {
            const input = document.getElementById("qty");
            let newValue = parseInt(input.value) + delta;
            if (newValue < 1) newValue = 1;
            input.value = newValue;
        }

        async function startPayment() {
            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("email").value.trim();

            if (!selectedAmount) {
                alert("Kérlek válassz összeget!");
                return;
            }
            if (!name || !email) {
                alert("Kérlek add meg a nevet és az email címet!");
                return;
            }

            const qty = parseInt(document.getElementById("qty").value) || 1;

            try {
                // a backend endpointot hívjuk, nem közvetlen a Bariont
                const response = await fetch("/api/giftcard/start-payment", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        name,
                        email,
                        amount: selectedAmount,
                        qty
                    })
                });

                const data = await response.json();
                console.log("Backend response:", data);

                if (data.GatewayUrl) {
                    // átirányítás a Barion fizetőoldalra
                    window.location.href = data.GatewayUrl;
                } else {
                    alert("Hiba történt: " + (data.Errors?.[0]?.Title || "Ismeretlen hiba"));
                }
            } catch (err) {
                console.error("Hálózati hiba:", err);
                alert("Nem sikerült kapcsolódni a szerverhez.");
            }
        }
    </script>




    <!-- Bootstrap + JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
        crossorigin="anonymous"></script>
    <!-- === Szükséges scriptek (nem kell cookie consent) === -->

    <!-- Barion fizetési integráció -->
    <script src="https://api.barion.com/js/barion.js" defer></script>

    <!-- Cal.com időpontfoglaló -->
    <script src="https://cal.com/embed.js" async></script>

    <!-- Saját oldal működése -->
    <script src="/js/main.js" defer></script>

    <!-- Cookie consent manager (később az analitika/marketinghez) -->
    <script src="/js/consent.js" defer></script>


</body>

</html>